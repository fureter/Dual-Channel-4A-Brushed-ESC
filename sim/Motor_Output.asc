Version 4
SHEET 1 2936 1220
WIRE -880 -384 -1088 -384
WIRE -1088 -320 -1088 -384
WIRE 560 -240 352 -240
WIRE 640 -240 560 -240
WIRE 1024 -240 640 -240
WIRE 1360 -240 1120 -240
WIRE -1088 -192 -1088 -240
WIRE 640 -176 640 -240
WIRE 1120 -176 1120 -240
WIRE 1360 -176 1360 -240
WIRE -864 -64 -1088 -64
WIRE -704 -64 -800 -64
WIRE 1120 -48 1120 -96
WIRE 1360 -48 1360 -96
WIRE -864 -32 -992 -32
WIRE 352 -32 352 -240
WIRE 560 -32 560 -240
WIRE 640 -32 640 -96
WIRE -1088 -16 -1088 -64
WIRE -992 -16 -992 -32
WIRE 272 32 160 32
WIRE 288 32 272 32
WIRE 1024 32 1024 -240
WIRE 288 48 288 32
WIRE 304 48 288 48
WIRE 272 64 272 32
WIRE 1360 80 1360 32
WIRE 640 96 640 48
WIRE 64 112 0 112
WIRE 112 112 64 112
WIRE -1088 128 -1088 64
WIRE -992 128 -992 64
WIRE 352 144 352 64
WIRE 352 144 272 144
WIRE 160 176 160 128
WIRE 160 176 112 176
WIRE 112 192 112 176
WIRE 112 192 64 192
WIRE 160 192 160 176
WIRE 1360 208 1360 160
WIRE 352 224 352 144
WIRE 640 224 640 176
WIRE -1680 320 -1696 320
WIRE -1552 320 -1568 320
WIRE 560 336 560 32
WIRE 640 336 640 304
WIRE 640 336 560 336
WIRE 1024 336 1024 96
WIRE 1024 336 640 336
WIRE 640 352 640 336
WIRE -1696 416 -1696 320
WIRE -1696 416 -1856 416
WIRE -1616 416 -1616 320
WIRE -1568 416 -1568 320
WIRE -1568 416 -1616 416
WIRE -1488 416 -1488 320
WIRE -1424 416 -1488 416
WIRE -1280 416 -1344 416
WIRE -1104 416 -1200 416
WIRE -2224 432 -2352 432
WIRE -2128 432 -2224 432
WIRE -2064 432 -2128 432
WIRE -2352 464 -2352 432
WIRE -2064 464 -2064 432
WIRE -1856 464 -1856 416
WIRE -2224 480 -2224 432
WIRE 832 512 736 512
WIRE 32 576 32 528
WIRE 32 576 -48 576
WIRE 112 576 32 576
WIRE 192 576 112 576
WIRE 32 592 32 576
WIRE 832 592 736 592
WIRE -2352 608 -2352 544
WIRE -2224 608 -2224 544
WIRE -2224 608 -2352 608
WIRE -2064 608 -2064 544
WIRE -2064 608 -2224 608
WIRE -1856 608 -1856 544
WIRE -1856 608 -2064 608
WIRE -1584 608 -1856 608
WIRE -1104 608 -1504 608
WIRE -1104 640 -1104 608
WIRE 32 640 -48 640
WIRE 112 640 32 640
WIRE 192 640 112 640
WIRE 32 688 32 640
WIRE -2352 720 -2352 608
WIRE -208 752 -672 752
WIRE -352 848 -416 848
WIRE -208 848 -208 752
WIRE -208 848 -272 848
WIRE -128 848 -208 848
WIRE -96 848 -128 848
WIRE -672 864 -672 752
WIRE -624 864 -672 864
WIRE -624 896 -736 896
WIRE -128 896 -128 848
WIRE -208 912 -208 848
WIRE -208 912 -416 912
WIRE -736 928 -736 896
WIRE -624 928 -736 928
WIRE -736 944 -736 928
WIRE -336 944 -416 944
WIRE -672 960 -672 864
WIRE -624 960 -672 960
WIRE -336 976 -336 944
WIRE -336 976 -416 976
WIRE -128 1008 -128 960
WIRE -336 1088 -336 976
WIRE -272 1088 -336 1088
WIRE -208 1088 -272 1088
WIRE -128 1088 -208 1088
WIRE -336 1104 -336 1088
WIRE -272 1104 -272 1088
WIRE -208 1104 -208 1088
WIRE -336 1168 -336 1152
WIRE -336 1200 -336 1168
WIRE -272 1200 -272 1168
WIRE -208 1200 -208 1168
FLAG 160 192 0
FLAG -1088 128 0
FLAG -992 128 0
FLAG 640 352 0
FLAG 1360 208 0
FLAG 1120 -48 0
FLAG 352 -240 MOT
IOPIN 352 -240 Out
FLAG -1088 -192 0
FLAG -880 -384 0
FLAG -704 -64 PWM
FLAG -80 112 PWM
FLAG 352 224 VCC
FLAG -2352 720 0
FLAG -1104 640 0
FLAG -1104 416 VCC
FLAG -2128 432 vsoc
FLAG 736 512 V_Filtered
FLAG 736 592 0
FLAG 32 688 0
FLAG 32 528 VCC
FLAG -128 1008 0
FLAG -736 944 0
FLAG -336 1200 0
FLAG -272 1200 0
FLAG -208 1200 0
FLAG -128 1088 V_Filtered
FLAG -96 848 VCC
SYMBOL nmos 112 32 R0
SYMATTR InstName M1
SYMATTR Value 2N7002
SYMBOL pmos 304 -32 R0
SYMATTR InstName M2
SYMATTR Value AO3423
SYMBOL res 256 48 R0
SYMATTR InstName R2
SYMATTR Value 10K
SYMBOL res 48 96 R0
SYMATTR InstName R3
SYMATTR Value 10K
SYMBOL res 16 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL Misc\\signal -1088 -32 R0
WINDOW 3 -291 105 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PWL(0 3.2 1 3.2 1.1 1.4 1.5 1.4 1.55 0 1.95 0. 2 1.4 2.1 2.8 3 2.8 3.1 3.2 4 3.2)
SYMATTR InstName V2
SYMBOL Misc\\signal -992 -32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 3.2 1p {0.5/freq} {0.5/freq} 1p {1/freq} 100000)
SYMBOL Digital\\diffschmitt -864 -112 R0
WINDOW 0 10 -8 Left 2
WINDOW 3 9 17 Left 2
SYMATTR InstName A1
SYMATTR Value vt=0 vh=0 vhigh=3.3
SYMBOL ind 624 -192 R0
SYMATTR InstName L1
SYMATTR Value {L_MOT}
SYMBOL res 624 -48 R0
SYMATTR InstName R1
SYMATTR Value {R_MOT}
SYMBOL voltage 640 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_SENSE_1
SYMATTR Value 0
SYMBOL ind 1344 -192 R0
SYMATTR InstName L2
SYMATTR Value {L_Intertia}
SYMBOL res 1344 -64 R0
SYMATTR InstName R5
SYMATTR Value {R_LOSS}
SYMBOL voltage 1360 64 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_SENSE_2
SYMATTR Value 0
SYMBOL bv 1120 -192 R0
SYMATTR InstName B1
SYMATTR Value V=I(V_SENSE_1)*K_t
SYMBOL bv 640 80 R0
SYMATTR InstName B2
SYMATTR Value V=I(V_SENSE_2)*K_emf
SYMBOL bi -1088 -320 R0
SYMATTR InstName B3
SYMATTR Value I=(idt(I(V_SENSE_1)) - delay(idt(I(V_SENSE_1)),time_p))/time_p
SYMBOL schottky 1040 96 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value PMEG2010AEB
SYMBOL cap -64 576 R0
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL cap 96 576 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL cap 176 576 R0
SYMATTR InstName C4
SYMATTR Value 100µ
SYMBOL cap 544 -32 R0
SYMATTR InstName C7
SYMATTR Value 1µ
SYMBOL res -2368 448 R0
SYMATTR InstName R
SYMATTR Value 100k
SYMBOL cap -2240 480 R0
SYMATTR InstName C8
SYMATTR Value 0.5m
SYMBOL bi -2064 464 R0
SYMATTR InstName B4
SYMATTR Value I=I(R10)
SYMBOL bv -1856 448 R0
SYMATTR InstName B5
SYMATTR Value V=4.2*(-8.0128*pwr(V(vsoc),5) + 22.509*pwr(V(vsoc),4) - 19.929*pwr(V(vsoc),3) + 4.332*pwr(V(vsoc),2) + 2.0965*V(vsoc) + 0.0026)
SYMBOL cap -1616 304 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 1000p
SYMBOL cap -1488 304 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C10
SYMATTR Value 10µ
SYMBOL res -1600 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value .1
SYMBOL res -1472 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value .1
SYMBOL res -1328 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 0.1
SYMBOL ind -1184 400 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L3
SYMATTR Value 1n
SYMBOL res -1488 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1m
SYMBOL res 816 496 R0
SYMATTR InstName Receiver
SYMATTR Value 30E6
SYMBOL AutoGenerated\\TPS61253A_TRANS -528 912 R0
SYMATTR InstName U1
SYMATTR SpiceLine STEADY_STATE=0
SYMBOL ind -256 832 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L5
SYMATTR Value 0.56µ
SYMBOL cap -144 896 R0
SYMATTR InstName C2
SYMATTR Value 4.7µ
SYMBOL cap -352 1104 R0
SYMATTR InstName C5
SYMATTR Value 10µ
SYMBOL cap -288 1104 R0
SYMATTR InstName C6
SYMATTR Value 4.7µ
SYMBOL cap -224 1104 R0
SYMATTR InstName C12
SYMATTR Value 4.7µ
TEXT -968 -520 Left 2 !.tran 0 4 0
TEXT -1088 -488 Left 2 !.param freq2=freq/sin_dev sin_dev=300 freq=1000 K_t=800u K_emf=600u L_MOT=67n R_MOT=2.8 R_LOSS=50n L_Intertia=15n
TEXT -1088 -464 Left 2 !.param time_p=4/freq
TEXT -2352 832 Left 2 ;Ccapacity = 3600*Capacit(Ahr)*f1(Cycle)*f2(Temp)
TEXT -2352 856 Left 2 ;vsoc initial condition of 1V is 100%, 0V is 0% SOC
TEXT -2152 392 Left 2 !.ic V(vsoc) = 1
